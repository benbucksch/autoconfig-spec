<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Mail Autoconfig</title>
<meta content="Ben Bucksch" name="author">
<meta content="
       Set up a mail account with only email address and password. 
    " name="description">
<meta content="xml2rfc 3.23.1" name="generator">
<meta content="config" name="keyword">
<meta content="autoconfig" name="keyword">
<meta content="autodiscover" name="keyword">
<meta content="mail" name="keyword">
<meta content="IMAP" name="keyword">
<meta content="POP3" name="keyword">
<meta content="SMTP" name="keyword">
<meta content="JMAP" name="keyword">
<meta content="draft-ietf-mailmaint-autoconfig-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.1
    Python 3.12.6
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-mailmaint-autoconfig.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">autoconfig</td>
<td class="right">September 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Bucksch</td>
<td class="center">Expires 28 March 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">mailmaint</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-mailmaint-autoconfig-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-09-24" class="published">24 September 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-03-28">28 March 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Bucksch</div>
<div class="org">Beonex</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Mail Autoconfig</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Set up a mail account with only email address and password.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://benbucksch.github.io/autoconfig-spec/draft-autoconfig-1.html">https://benbucksch.github.io/autoconfig-spec/draft-autoconfig-1.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-mailmaint-autoconfig/">https://datatracker.ietf.org/doc/draft-ietf-mailmaint-autoconfig/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        mailmaint Working Group mailing list (<span><a href="mailto:mailmaint@ietf.org">mailto:mailmaint@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/mailmaint/">https://mailarchive.ietf.org/arch/browse/mailmaint/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/mailmaint/">https://www.ietf.org/mailman/listinfo/mailmaint/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/benbucksch/autoconfig-spec">https://github.com/benbucksch/autoconfig-spec</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 March 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-implementations" class="internal xref">Implementations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-data-format" class="internal xref">Data format</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-sample-config-file" class="internal xref">Sample config file</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-formal-definition" class="internal xref">Formal definition</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-placeholders" class="internal xref">Placeholders</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-config-retrieval-for-mail-c" class="internal xref">Config retrieval for mail clients</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-mail-provider" class="internal xref">Mail provider</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-customzing-the-config-for-a" class="internal xref">Customzing the config for a specific user</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-central-database" class="internal xref">Central database</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-mx" class="internal xref">MX</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-local-disk" class="internal xref">Local disk</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-other-mechanisms" class="internal xref">Other mechanisms</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-manual-configuration" class="internal xref">Manual configuration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-config-validation" class="internal xref">Config validation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-user-approval" class="internal xref">User approval</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-login-testing" class="internal xref">Login testing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-oauth2-windows" class="internal xref">OAuth2 windows</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-config-publishing-for-mail-" class="internal xref">Config publishing for mail providers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-config-location-for-single-" class="internal xref">Config location for single domain</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-config-location-for-domain-" class="internal xref">Config location for domain hosters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-no-authentication-for-confi" class="internal xref">No authentication for config</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-return-config-for-non-exist" class="internal xref">Return config for non-existing email addresses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="auto internal xref">6.5</a>.  <a href="#name-oauth2-requirements" class="internal xref">OAuth2 requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-alternatives-considered" class="internal xref">Alternatives considered</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-dnssec" class="internal xref">DNSSEC</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-dns-srv" class="internal xref">DNS SRV</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-capabilities" class="internal xref">CAPABILITIES</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-risk" class="internal xref">Risk</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-dns" class="internal xref">DNS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-config-updates" class="internal xref">Config updates</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-server-security" class="internal xref">Server security</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This protocol allows users to set up their existing email account in a new mail client application,
by entering only their name, email address, and password.
The mail application, by means of mail autoconfig specified here, will determine all the other
parameters that are required, including IMAP or POP3 hostname, TLS configuration,
form of username, authentication method, and other settings, and likewise for SMTP.
Contact sync and calendar, file sharing and other services can also be set up automatically.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The protocol works by first determining the domain from the email address, and the querying
well-known URLs at the email provider, which return the configuration parameters in computer-readable form. Failing that, various fallback sources can be applied, like a common database of
configurations for large email providers who do not directly support this protocol,
or other mechanisms to determine the configuration.<a href="#section-1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementations">
<section id="section-2">
      <h2 id="name-implementations">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-implementations" class="section-name selfRef">Implementations</a>
      </h2>
<p id="section-2-1">This protocol is in production use since 15 years by major email clients, and the
config database (used as fallback) contains configurations for over 50% of all email accounts.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Currently, this protocol or parts of it has been implemented by:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1"><a href="https://thunderbird.net">Thunderbird</a><a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1"><a href="https://projects.gnome.org/evolution/">Evolution</a><a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1"><a href="https://userbase.kde.org/KMail">KMail</a><a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">
          <p id="section-2-3.4.1"><a href="https://www.kontact.org">Kontact</a><a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.5">
          <p id="section-2-3.5.1"><a href="https://k9mail.app">K9 Mail</a><a href="#section-2-3.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.6">
          <p id="section-2-3.6.1"><a href="https://email.faircode.eu">FairEmail</a><a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.7">
          <p id="section-2-3.7.1"><a href="https://apps.nextcloud.com/apps/mail">NextCloud email</a><a href="#section-2-3.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.8">
          <p id="section-2-3.8.1"><a href="https://delta.chat/">Delta Chat</a><a href="#section-2-3.8.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-4">and likely other mail clients.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The purpose of this paper is to document and specify what is deployed in the wild. A later version 2 of the protocol might be based on JSON.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Additionally, there are known problems with OAuth2 in combination with mail clients, which would need to be solved by another specification.<a href="#section-2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="data-format">
<section id="section-3">
      <h2 id="name-data-format">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-data-format" class="section-name selfRef">Data format</a>
      </h2>
<p id="section-3-1">Whether the ISP or a common central database returns the configuration, the resulting
document has the following data format.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The MIME type is <code>text/xml</code> or <code>text/xml+autoconfig</code>.<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="sample-config-file">
<section id="section-3.1">
        <h3 id="name-sample-config-file">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-sample-config-file" class="section-name selfRef">Sample config file</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-3.1-1">
<pre>
&lt;?xml version="1.0"?&gt;
&lt;clientConfig version="1.2"&gt;
    &lt;emailProvider id="example.com"&gt;
      &lt;domain&gt;example.com&lt;/domain&gt;
      &lt;domain&gt;example.net&lt;/domain&gt;

      &lt;displayName&gt;Google Mail&lt;/displayName&gt;
      &lt;displayShortName&gt;GMail&lt;/displayShortName&gt;

      &lt;!-- type=
          "imap": IMAP
          "pop3": POP3
          "jmap": JMAP
          "ews": Microsoft Exchange Web Services
          "activesync": Microsoft ActiveSync
          --&gt;
      &lt;incomingServer type="imap"&gt;
        &lt;hostname&gt;imap.example.com&lt;/hostname&gt;
        &lt;port&gt;993&lt;/port&gt;
          &lt;!-- "plain": no encryption
                "SSL": SSL 3 or TLS 1 on SSL-specific port
                "STARTTLS": on normal plain port and mandatory upgrade to TLS via STARTTLS
                --&gt;
        &lt;socketType&gt;SSL&lt;/socketType&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
            &lt;!-- Authentication methods:
                "password-cleartext",
                          Send password in the clear
                          (dangerous, if SSL isn't used either).
                          AUTH PLAIN, LOGIN or protocol-native login.
                "password-encrypted",
                          A secure encrypted password mechanism.
                          Can be CRAM-MD5 or DIGEST-MD5. Not NTLM.
                "NTLM":
                          Use NTLM (or NTLMv2 or successors),
                          the Windows login mechanism.
                "GSSAPI":
                          Use Kerberos / GSSAPI,
                          a single-signon mechanism used for big sites.
                "TLS-client-cert":
                          On the SSL/TLS layer, the server requests a client certificate and the client sends one (possibly after letting the user select/confirm one), if available.
                "OAuth2":
                          mAuth. Should be added only as second alternative.
                "none":
                          No authentication
                --&gt;
        &lt;authentication&gt;password-cleartext&lt;/authentication&gt;
        &lt;password&gt;optional: the user's password&lt;/password&gt;
      &lt;/incomingServer&gt;

      &lt;!-- You can have multiple incoming servers,
        and even multiple IMAP server configs.
        The first config is the preferred one, but the user or
        or client can choose the alternative configs. --&gt;
      &lt;incomingServer type="pop3"&gt;
        &lt;hostname&gt;pop.example.com&lt;/hostname&gt;
        &lt;port&gt;995&lt;/port&gt;
        &lt;socketType&gt;SSL&lt;/socketType&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;authentication&gt;password-cleartext&lt;/authentication&gt;
        &lt;pop3&gt;
            &lt;!-- optional --&gt;
            &lt;leaveMessagesOnServer&gt;true&lt;/leaveMessagesOnServer&gt;
            &lt;daysToLeaveMessagesOnServer&gt;14&lt;/daysToLeaveMessagesOnServer&gt;
        &lt;/pop3&gt;
      &lt;/incomingServer&gt;

      &lt;!-- Needed only for IMAP or POP3 --&gt;
      &lt;outgoingServer type="smtp"&gt;
        &lt;hostname&gt;smtp.googlemail.com&lt;/hostname&gt;
        &lt;port&gt;587&lt;/port&gt;
        &lt;socketType&gt;STARTTLS&lt;/socketType&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt; &lt;!-- if smtp-auth --&gt;
            &lt;!-- smtp-auth (RFC 2554, 4954) or other auth mechanism.
                For values, see incoming.
                Additional options here:
                "client-IP-address":
                          The server recognizes this user based on the IP address.
                          No authentication needed, the server will require no username nor password.
            --&gt;
        &lt;authentication&gt;password-cleartext&lt;/authentication&gt;
        &lt;password&gt;optional: the user's password&lt;/password&gt;
      &lt;/outgoingServer&gt;

      &lt;incomingServer type="jmap"&gt;
        &lt;url&gt;https://jmap.example.com&lt;/url&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;authentication&gt;http-basic&lt;/authentication&gt;
      &lt;/incomingServer&gt;

      &lt;incomingServer type="ews"&gt;
        &lt;url&gt;https://mail.example.com/EWS/Exchange.asmx&lt;/url&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;authentication&gt;http-basic&lt;/authentication&gt;
      &lt;/incomingServer&gt;

      &lt;incomingServer type="activesync"&gt;
        &lt;url&gt;https://mail.example.com/Microsoft-Server-ActiveSync&lt;/url&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;authentication&gt;OAuth2&lt;/authentication&gt;
      &lt;/incomingServer&gt;

      &lt;!-- A page where the ISP describes the configuration.
          This is purely informational and currently mainly for
          maintenance of the files and not used by the client at all.
          Note that we do not necessarily use exactly the config suggested
          by the ISP, e.g. when they don't recommend SSL, but it's available,
          we will configure SSL.
          The text content should contains a description in the native
          language of the ISP (customers), and a short English description,
          mostly for us.
      --&gt;
      &lt;documentation url="http://www.example.com/help/mail/"&gt;
        &lt;descr lang="en"&gt;Configure mail app for IMAP&lt;/descr&gt;
        &lt;descr lang="de"&gt;Email mit IMAP konfigurieren&lt;/descr&gt;
      &lt;/documentation&gt;

    &lt;/emailProvider&gt;

    &lt;!-- Syncronize the user's address book / contacts. --&gt;
    &lt;addressBook type="carddav"&gt;
      &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;!-- Authentication methods. See also &lt;incomingServer&gt;.
              "http-basic":
                        Authenticate to the HTTP server using
                        WWW-Authenticate: Basic
              "http-digest":
                        Authenticate to the HTTP server using
                        WWW-Authenticate: Digest
              "OAuth2":
                        mAuth. Uses the same token as for email. &lt;scope&gt; needs to include
                         addressbook/calendar.
              --&gt;
      &lt;authentication&gt;http-basic&lt;/authentication&gt;
      &lt;url&gt;https://jmap.example.com/remote.php/dav&lt;/url&gt;
    &lt;/addressBook&gt;

    &lt;!-- Syncronize the user's calendar. --&gt;
    &lt;calendar type="caldav"&gt;
      &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
      &lt;authentication&gt;http-basic&lt;/authentication&gt; &lt;!-- see &lt;addressBook&gt; --&gt;
      &lt;url&gt;https://calendar.example.com/remote.php/dav&lt;/url&gt;
    &lt;/calendar&gt;

    &lt;!-- Upload files, allowing the user to share them.
        This can be used for Thunderbird's FileLink feature,
        or to set up a file sync folder on the user's desktop. --&gt;
    &lt;fileShare type="webdav"&gt;
      &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
      &lt;authentication&gt;http-basic&lt;/authentication&gt; &lt;!-- see &lt;addressBook&gt; --&gt;
      &lt;url&gt;https://share.example.com/remote.php/dav&lt;/url&gt;
    &lt;/fileShare&gt;

    &lt;!-- This allows to login in to the webmail service of the provider.
        The URLs are loaded into a standard webbrowser for the user.
        This is optional. --&gt;
    &lt;webMail&gt;
      &lt;!-- Webpage where the user has to log in manually by entering username
          and password himself.
          HTTPS required. --&gt;
      &lt;loginPage url="https://mail.example.com/login/" /&gt;

      &lt;!-- Same as loginAutomaticDOM, but the website makes checks that
          the user comes from the login page. So, open the login page
          in the browser, get the page's DOM, fill out name and password
          fields for the user, and trigger the login button.
          The login button might not be an HTML button, just a div, so
          to trigger it, send a click event to it.
          HTTPS is required for the URL. --&gt;
      &lt;loginPageInfo url="https://mail.example.com/login/"&gt;
        &lt;!-- What to fill into the usernameField.
            Format is the same as for &lt;username&gt; within &lt;incomingServer&gt;,
            including placeholders. See below for valid placeholders. --&gt;
        &lt;username&gt;%EMAILADDRESS%&lt;/username&gt;
        &lt;!-- Allows to find the textfield on the page, to fill it out.
            The id attribute give the DOM ID,
            The name attribute give the DOM name attribute.
            One or both of id and name attributes must exist.
            Try the ID first (e.g. using getElementById()), if existing.
            Otherwise, try finding the element by name.
            Don't treat the IDs given in this XML file as trusted,
            but before using them, verify the format
            (e.g. only characters and digits for IDs).
            If you use powerful functions like jQuery, and the XML returns
            you code in the username ID, and you feed it unchecked to jQuery,
            it may be executed. --&gt;
        &lt;usernameField id="email_field" name="email" /&gt;
        &lt;passwordField name="password" /&gt;
        &lt;!-- The submit button to trigger the server submit
            after filling in the fields.
            id and name attributes: See &lt;usernameField&gt; --&gt;
        &lt;loginButton id="submit_button" name="login"/&gt;
      &lt;/loginPageInfo&gt;
    &lt;/webMail&gt;

    &lt;!-- Ask user for custom input,
       and use them as placeholders in the values.
       Optional. --&gt;
    &lt;inputField key="USERNAME" label="Screen name"&gt;&lt;/inputField&gt;
    &lt;inputField key="GRANDMA" label="Grandma"&gt;Elise Bauer&lt;/inputField&gt;

    &lt;!-- oAuth2 specced for mail apps,
        e.g. clientID, expiry, and login page
        MUST adhere to mAuth &lt;https://benbucksch.github.io/mauth-spec/draft-mauth.html&gt;
        --&gt;
    &lt;mAuth&gt;
      &lt;authURL&gt;https://login.example.com/common/oauth2/v2.0/authorize&lt;/authURL&gt;
      &lt;tokenURL&gt;https://login.example.com/common/oauth2/v2.0/token&lt;/tokenURL&gt;
      &lt;issuer&gt;login.example.com&lt;/issuer&gt;
      &lt;scope&gt;IMAP POP3 SMTP CalDAV CardDAV WebDAV offline_access&lt;/scope&gt;
      &lt;clientID&gt;open&lt;/clientID&gt;
      &lt;!-- optional --&gt;
      &lt;clientSecret&gt;give-me-your-pass-word&lt;/clientSecret&gt;
    &lt;/mAuth&gt;

    &lt;!-- Add this only when users (who already have an account) have to
        do something manually before the account can work with IMAP/POP or SSL.
        Mandatory only if the ISP requires such settings
        before the configs above work.
        Note: Per XML, &amp; (ampersand) needs to be escaped to
        &amp; a m p ; (without spaces). --&gt;
    &lt;enable
      visiturl="https://mail.google.com/mail/?ui=2&amp;amp;shva=1#settings/fwdandpop"&gt;
      &lt;instruction&gt;Check 'Enable IMAP and POP' in Google settings page&lt;/instruction&gt;
      &lt;instruction lang="de"&gt;Schalten Sie 'IMAP und POP aktivieren' auf der Google Einstellungs-Seite an&lt;/instruction&gt;
    &lt;/enable&gt;

    &lt;clientConfigUpdate url="https://www.example.com/config/mail.xml" /&gt;

&lt;/clientConfig&gt;
</pre><a href="#section-3.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="formal-definition">
<section id="section-3.2">
        <h3 id="name-formal-definition">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-formal-definition" class="section-name selfRef">Formal definition</a>
        </h3>
<p id="section-3.2-1">TODO Schema for XML<a href="#section-3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="placeholders">
<section id="section-3.3">
        <h3 id="name-placeholders">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-placeholders" class="section-name selfRef">Placeholders</a>
        </h3>
<p id="section-3.3-1">The fields for <code>&lt;username&gt;</code>, <code>&lt;hostname&gt;</code>, <code>&lt;serverURL&gt;</code>,
<code>&lt;displayName&gt;</code>, <code>&lt;displayShortName&gt;</code> (*1) support placeholders.
The config returned by the autoconfig server may contain these placeholders,
which are to be replaced by the client.
The following special strings (or substrings/parts) of the value should be replaced
by the client, after the config was retrieved and before its values are actually
used.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Placeholder</th>
              <th class="text-left" rowspan="1" colspan="1">Replace with</th>
              <th class="text-left" rowspan="1" colspan="1">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>%EMAILADDRESS%</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">E-Mail-Address of the user</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fred@example.com</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>%EMAILLOCALPART%</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Part before <code>@</code> in the E-Mail-Address</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fred</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>%EMAILDOMAIN%</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Part after <code>@</code> in the E-Mail-Address</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>example.com</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>%REALNAME%</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Real-world name of the user</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>Fred Flintstone</code>
</td>
            </tr>
          </tbody>
        </table>
<p id="section-3.3-3">*1 and possibly <code>&lt;inputField&gt;</code> value, <code>&lt;authURL&gt;</code>, <code>&lt;tokenURL&gt;</code>, <code>&lt;issuer&gt;</code><a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="config-retrieval-for-mail-clients">
<section id="section-4">
      <h2 id="name-config-retrieval-for-mail-c">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-config-retrieval-for-mail-c" class="section-name selfRef">Config retrieval for mail clients</a>
      </h2>
<p id="section-4-1">The mail client application, when it needs the configuration for a given email address,
will perform several steps to retrieve the configuration from various sources.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The steps are ordered by priority. They may all be requested at the same time, but a higher priorty
result that is available <span class="bcp14">MUST</span> be preferred over a lower priority one, even if the lower priority one is available earlier. Lower priority requests <span class="bcp14">MAY</span> be cancelled, if a valid higher priority result has been successfully received. The priority is expressed below with the number before the URL or location, with lower numbers meaning higher priority, e.g. 1.2 has higher priority than 4.1.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">In the URLs below,<code>%EMAILADDRESS%</code> shall be replaced with the email address that the user entered and wishes to use, and <code>%EMAILDOMAIN%</code> shall be replaced with the email domain extracted from the email address. For example, for "fred@example.com", the email domain is "example.com", and for "fred@test.cs.example.net", the email domain is "test.cs.example.net".<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">For full support of this specification, all "Required" and "Recommended" mechanisms <span class="bcp14">MUST</span> be implemented and working. For partial support of this specification, all "Required" mechanisms <span class="bcp14">MUST</span> be implemented and working, and in this case, you shall make explicit when advertizing or referring to auto config that there is only partial support of this specification.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="mail-provider">
<section id="section-4.1">
        <h3 id="name-mail-provider">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-mail-provider" class="section-name selfRef">Mail provider</a>
        </h3>
<p id="section-4.1-1">First step is to directly ask the mail provider and allow it to return the configuration. This step ensures that the protocol is decentralized and the mail provider is in control of the configuration issued to mail clients.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">1.1. <code>https://autoconfig.%EMAILDOMAIN%/mail/config-v1.1.xml?emailaddress=%EMAILADDRESS%</code> (Required)<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">1.2. <code>https://%EMAILDOMAIN%/.well-known/autoconfig/mail/config-v1.1.xml</code> (Optional)<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1">1.3. <code>http://autoconfig.%EMAILDOMAIN%/mail/config-v1.1.xml</code> (Optional)<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">For example:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-4.1">
            <p id="section-4.1-4.1.1">1.1. https://autoconfig.example.com/mail/config-v1.1.xml?emailaddress=fred@example.com<a href="#section-4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.2">
            <p id="section-4.1-4.2.1">1.2. https://example.com/.well-known/autoconfig/mail/config-v1.1.xml<a href="#section-4.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-4.3">
            <p id="section-4.1-4.3.1">1.3. http://autoconfig.example.com/mail/config-v1.1.xml<a href="#section-4.1-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-5">Step 1.3. is mainly for legacy servers. Many current deployments
use this HTTP URL.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div id="customzing-the-config-for-a-specific-user">
<section id="section-4.1.1">
          <h4 id="name-customzing-the-config-for-a">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-customzing-the-config-for-a" class="section-name selfRef">Customzing the config for a specific user</a>
          </h4>
<p id="section-4.1.1-1">To allow the mail provider to return a configuration adjusted for that mailbox, the
client sends the email address as query parameter in URL 1.1. This allows the mail
provider to e.g. separate mailboxes on geographically local mail servers, e.g. a
mail server located in the same office building where an employee works.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">However, while the protocol allows for such heterogenous configurations, mail
providers are discouraged from doing so, and are instead encouraged to provide one
single configuration for all their users. For example, DNS resolution based on
location, mail proxy servers, or other techniques as necessary, can be used to
route the traffic and host the mail efficiently.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1-3">This mechanism also allows the autoconfig server to map the email address to
a username that cannot be expressed using the Placeholders (see section).
However, this method is discouraged. Instead, the email server login should accept
email addresses as username, and doing the mapping to internal usernames at login
time, which avoids the need for the client to know a different username.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1-4">To avoid that email addresses can be tested for validity, whenever customized
configs are returned, the autoconfig server should respond to non-existing email
addresses with a configuation that appears to be real and is similar in structure
to real configurations, e.g. a random host out of the pool of actual hosts.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="central-database">
<section id="section-4.2">
        <h3 id="name-central-database">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-central-database" class="section-name selfRef">Central database</a>
        </h3>
<p id="section-4.2-1">The ISPDB contains the configurations for most mail providers with a market share larger than 0.1%, and contains configurations for half of the email accounts in the world.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">This is a useful fallback for mail providers which do not host a config server described in the previous step. Using a central database (ISPDB) of mail configurations for the large mail providers will increase the success rate of finding a valid configuration drastically, up to 10-fold.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">The mail client application may choose the mail config database provider. A public mail config database is available at base URL <code>https://v1.ispdb.net/</code>.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4"><code>%ISPDB%</code> below is the base URL of that database.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-5.1">
            <p id="section-4.2-5.1.1">2.1. <code>%ISPDB%%EMAILDOMAIN%</code> (Recommended)<a href="#section-4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-6">For example:<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-7.1">
            <p id="section-4.2-7.1.1">2.1. <a href="https://v1.ispdb.net/geologist.com">https://v1.ispdb.net/geologist.com</a><a href="#section-4.2-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="mx">
<section id="section-4.3">
        <h3 id="name-mx">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-mx" class="section-name selfRef">MX</a>
        </h3>
<p id="section-4.3-1">Many companies do not maintain their own mail server, but let their email be hosted by a hosting company, which is then responsible for the email of dozens or thousands of domains. For these hosters, it may be difficult to set up the configuration server (step 1.1.) with valid TLS certificate for each of their customers, and to convince their customers to modify their root DNS specifically for autoconfig. On the other side, the ISPDB can only contain the hosting company and cannot know all their customers. To handle such domains, the protocol first needs to find the server hosting the email.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">If the previous mechanisms yield no result, the client may perform a DNS MX lookup on the email domain, and retrieve the MX server (incoming email server) for that domain. Only the highest priority MX hostname is considered. From that MX hostname, 2 values are extracted:<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-3.1">
            <p id="section-4.3-3.1.1">Extract only the second-level domain from the MX hostname, and use that as value for <code>%MXBASEDOMAIN%</code>. To determine the second-level domain, use the <a href="https://publicsuffix.org">Public Suffic List</a> or a similarly suited method, to correctly handle domains like ".co.uk" and ".com.au".<a href="#section-4.3-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-3.2">
            <p id="section-4.3-3.2.1">Remove the first component from the MX hostname, i.e. everything up to and including the first <code>.</code>, and use that as value for <code>%MXFULLDOMAIN%</code>. If it is shorter or the
same length as <code>%MXBASEDOMAIN%</code>, then skip it.<a href="#section-4.3-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-4">For example:<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-5.1">
            <p id="section-4.3-5.1.1">For "mx.example.com", the MXFULLDOMAIN and MXBASEDOMAIN are both "example.com".<a href="#section-4.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-5.2">
            <p id="section-4.3-5.2.1">For "mx.example.co.uk", the MXFULLDOMAIN and MXBASEDOMAIN are both "example.co.uk".<a href="#section-4.3-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-5.3">
            <p id="section-4.3-5.3.1">For "mx.premium.europe.example.com", the MXFULLDOMAIN is "premium.europe.example.com" and the MXBASEDOMAIN is "example.com".<a href="#section-4.3-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-6">Then, attempt to retrieve the config for these MX domains, using the previous methods:<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.1">
            <p id="section-4.3-7.1.1">3.1. <code>https://autoconfig.%MXFULLDOMAIN%/.well-known/mail-v1.xml?emailaddress=%EMAILADDRESS%</code> (Required)<a href="#section-4.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.2">
            <p id="section-4.3-7.2.1">3.2. <code>https://autoconfig.%MXBASEDOMAIN%/.well-known/mail-v1.xml?emailaddress=%EMAILADDRESS%</code> (Recommended)<a href="#section-4.3-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.3">
            <p id="section-4.3-7.3.1">3.3. <code>%ISPDB%%MXFULLDOMAIN%</code> (Recommended)<a href="#section-4.3-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-7.4">
            <p id="section-4.3-7.4.1">3.4. <code>%ISPDB%%MXBASEDOMAIN%</code> (Recommended)<a href="#section-4.3-7.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-8">For example:<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-9.1">
            <p id="section-4.3-9.1.1">3.1. https://autoconfig.premium.europe.example.com/.well-known/mail-v1.xml?emailaddress=fred@example.com<a href="#section-4.3-9.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-9.2">
            <p id="section-4.3-9.2.1">3.2. https://autoconfig.example.com/.well-known/mail-v1.xml?emailaddress=fred@example.com<a href="#section-4.3-9.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-9.3">
            <p id="section-4.3-9.3.1">3.3. https://v1.ispdb.net/premium.europe.example.com<a href="#section-4.3-9.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-9.4">
            <p id="section-4.3-9.4.1">3.4. https://v1.ispdb.net/example.com<a href="#section-4.3-9.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="local-disk">
<section id="section-4.4">
        <h3 id="name-local-disk">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-local-disk" class="section-name selfRef">Local disk</a>
        </h3>
<p id="section-4.4-1">For testing purposes, you may want to define a location on the disk, relative to the application installation directory, or relative to the user configuration directory, which may contain a configuration file for a specific domain, and which your application will use, if the above methods fail.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">4.1. <code>%USER_CONFIGURATION_DIR%/isp/%EMAILDOMAIN%.xml</code> (Optional)<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">4.2. <code>%APP_INSTALL_DIR%/isp/%EMAILDOMAIN%.xml</code> (Optional)<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-3">For example:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-4.1">
            <p id="section-4.4-4.1.1">4.1. /home/fred/.config/yourapp/isp/example.com.xml<a href="#section-4.4-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-4.2">
            <p id="section-4.4-4.2.1">4.2. /opt/yourapp/isp/example.com.xml<a href="#section-4.4-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="other-mechanisms">
<section id="section-4.5">
        <h3 id="name-other-mechanisms">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-other-mechanisms" class="section-name selfRef">Other mechanisms</a>
        </h3>
<p id="section-4.5-1">You may want to implement other mechanisms to find a configuration, for example Exchange AutoDiscover, DNS SRV, or heuristic guessing. If you implement such alternative methods, and if they are less secure than some of the mechanisms provided here, the alternative methods <span class="bcp14">SHOULD</span> be considered only with lower priority (as defined above) than the more secure mechanisms defined here. For evaluating other mechanisms, use similar criteria as outlined in section "Security considerations".<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="manual-configuration">
<section id="section-4.6">
        <h3 id="name-manual-configuration">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-manual-configuration" class="section-name selfRef">Manual configuration</a>
        </h3>
<p id="section-4.6-1">If the above mechanisms fail to provide a working configuration, or if the user explicitly chooses so, you <span class="bcp14">SHOULD</span> give the end user the ability to manually enter a configuration, and use that configuration to configure the account.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="config-validation">
<section id="section-5">
      <h2 id="name-config-validation">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-config-validation" class="section-name selfRef">Config validation</a>
      </h2>
<div id="user-approval">
<section id="section-5.1">
        <h3 id="name-user-approval">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-user-approval" class="section-name selfRef">User approval</a>
        </h3>
<p id="section-5.1-1">Independent of the mechanisms used to find the configuration, before using that configuration, you <span class="bcp14">SHOULD</span> display that configuration to the end user and let him confirm it. While doing so:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
            <p id="section-5.1-2.1.1">At least the second-level domain name(s) of the hostnames involved <span class="bcp14">MUST</span> be shown clearly and with high prominence.<a href="#section-5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">The client <span class="bcp14">MUST NOT</span> cut off parts of long second-level domains, to avoid spoofing. At least 63 characters <span class="bcp14">MUST</span> be displayed.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.1-2.3">
            <p id="section-5.1-2.3.1">Care <span class="bcp14">SHOULD</span> be taken with international characters that look like ASCII characters, but have a different code.<a href="#section-5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="login-testing">
<section id="section-5.2">
        <h3 id="name-login-testing">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-login-testing" class="section-name selfRef">Login testing</a>
        </h3>
<p id="section-5.2-1">After the user confirmed the configuration, you <span class="bcp14">SHOULD</span> test the configuration, by attempting a login to each server configured. Only if the login succeeded, and the server is working, should the configuration be saved and retrieving and sending mail be started.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oauth2-windows">
<section id="section-5.3">
        <h3 id="name-oauth2-windows">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-oauth2-windows" class="section-name selfRef">OAuth2 windows</a>
        </h3>
<p id="section-5.3-1">If the configuration contains OAuth2 authentication, or any other authentication that uses a web browser with URL redirects, you <span class="bcp14">MUST</span> show the full URL or the second-level domain of the current page to the end user, at all times, including after page changes, URL changes or redirects. This allows the end user to verify that he is logging in at the expected page, e.g. the login server of their company.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">(Editor's note: Not really part of autoconfig, but autoconfig can enable OAuth2, and it's important that this is implemented correctly by mail applications.)<a href="#section-5.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="config-publishing-for-mail-providers">
<section id="section-6">
      <h2 id="name-config-publishing-for-mail-">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-config-publishing-for-mail-" class="section-name selfRef">Config publishing for mail providers</a>
      </h2>
<p id="section-6-1">Mail service providers who want to support this specification
and publish the mail configuration for their own mail service,
so that mail client apps can be automatically configured,
<span class="bcp14">SHOULD</span> follow this section as guideline and <span class="bcp14">MUST</span> respect the
definitions in this specification.<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">Configuration fields <span class="bcp14">MUST NOT</span> contain invalid or non-working
configuration data.<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">The provided configuration <span class="bcp14">MUST</span> be working,
and <span class="bcp14">SHOULD</span> use state-of-the-art security.<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">Configurations <span class="bcp14">MUST</span> be public and <span class="bcp14">MUST NOT</span> require
authentication (see below).<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="config-location-for-single-domain">
<section id="section-6.1">
        <h3 id="name-config-location-for-single-">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-config-location-for-single-" class="section-name selfRef">Config location for single domain</a>
        </h3>
<p id="section-6.1-1">The configuration file <span class="bcp14">SHOULD</span> be published at the URL for
step 1.1., i.e.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1"><code>https://autoconfig.%EMAILDOMAIN%/.well-known/mail-v1.xml?emailaddress=%EMAILADDRESS%</code><a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-3">e.g. for fred@example.com<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1">
            <p id="section-6.1-4.1.1">https://autoconfig.example.com/.well-known/mail-v1.xml?emailaddress=fred@example.com<a href="#section-6.1-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-5">For backwards compatibility with older mail clients,
step 1.2. should also be implemented.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="config-location-for-domain-hosters">
<section id="section-6.2">
        <h3 id="name-config-location-for-domain-">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-config-location-for-domain-" class="section-name selfRef">Config location for domain hosters</a>
        </h3>
<p id="section-6.2-1">For mail providers which host entire domains for their business
customers, the same URL as listed in the previous section is
preferred.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">Alternatively, the configuration file <span class="bcp14">SHOULD</span> be published at
the location for step 3.1., i.e.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-3.1">
            <p id="section-6.2-3.1.1"><code>https://autoconfig.%MXFULLDOMAIN%/.well-known/mail-v1.xml?emailaddress=%EMAILADDRESS%</code><a href="#section-6.2-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.2-4">E.g. if the MX server for customer domain example.net is "mx.premium.europe.example.com", then the config file should be at<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-5.1">
            <p id="section-6.2-5.1.1">https://autoconfig.premium.europe.example.com/.well-known/mail-v1.xml?emailaddress=fred@example.net<a href="#section-6.2-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.2-6">For backwards compatibility with older mail clients,
step 3.2. should also be implemented.<a href="#section-6.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="no-authentication-for-config">
<section id="section-6.3">
        <h3 id="name-no-authentication-for-confi">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-no-authentication-for-confi" class="section-name selfRef">No authentication for config</a>
        </h3>
<p id="section-6.3-1">Any of the above URLs for retrieving the config file <span class="bcp14">MUST NOT</span>
require authentication, but <span class="bcp14">MUST</span> be public.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">This is because the config contains the authentication method.
Without knowing the config, the client does not know which
authentication method is required and which username form
(e.g. username "fred" or "fred@example.com" or "fred\EXAMPLE")
to use. Given that the config is required for authentication,
the config itself cannot require authentication.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="return-config-for-non-existing-email-addresses">
<section id="section-6.4">
        <h3 id="name-return-config-for-non-exist">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-return-config-for-non-exist" class="section-name selfRef">Return config for non-existing email addresses</a>
        </h3>
<p id="section-6.4-1">Servers <span class="bcp14">SHOULD</span> return a valid config, even if the email address
sent as URL parameter does not exist. Otherwise, spammers
or attackers would be able to test the validity of email addresses.
This is true even if the config server needs the email address
to determine which of multiple configurations is correct.
In such a configuration, if the client sends a non-existing
email address, the config server <span class="bcp14">SHOULD</span> return one of the
valid configuations, so that valid and invalid email addresses
are indistiguishable.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oauth2-requirements">
<section id="section-6.5">
        <h3 id="name-oauth2-requirements">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-oauth2-requirements" class="section-name selfRef">OAuth2 requirements</a>
        </h3>
<p id="section-6.5-1">If OAuth2 is used, the OAuth2 server <span class="bcp14">MUST</span> adhere to the
<a href="https://benbucksch.github.io/mauth-spec/draft-mauth.html">mAuth</a>
specification.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">The OAuth2 server <span class="bcp14">MUST</span> either accept the public client ID
as given in the config file, without secret, or <span class="bcp14">MUST</span> allow the
string <code>open</code> as client ID, or both.<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<p id="section-6.5-3">There are also specific requirements for expiry times and
the login page, which are needed for mail client applications to work.<a href="#section-6.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-7">
      <h2 id="name-conventions-and-definitions">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-7-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="alternatives-considered">
<section id="section-8">
      <h2 id="name-alternatives-considered">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-alternatives-considered" class="section-name selfRef">Alternatives considered</a>
      </h2>
<div id="dnssec">
<section id="section-8.1">
        <h3 id="name-dnssec">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-dnssec" class="section-name selfRef">DNSSEC</a>
        </h3>
<p id="section-8.1-1">Due to their top-level domain, some domains do not have DNSSEC available to them, even if they would like to deploy it.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">Even where the top-level domain supports it, DNSSEC is currently deployed in only 1% of domains, with adoption rates falling instead of rising, due to the difficulties of administrating it correctly.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Therefore, DNSSEC cannot be relied on in this specification, and DNS must be considered insecure for the purposes of this specification.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dns-srv">
<section id="section-8.2">
        <h3 id="name-dns-srv">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-dns-srv" class="section-name selfRef">DNS SRV</a>
        </h3>
<p id="section-8.2-1">DNS SRV protocols (RFC 2782, RFC 6186) are not used here, for 2 reasons:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8.2-2">
<li id="section-8.2-2.1">
            <p id="section-8.2-2.1.1">DNS SRV relies on insecure DNS and the config can therefore be trivially spoofed by an attacker. See also DNSSEC above.<a href="#section-8.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-8.2-2.2">
            <p id="section-8.2-2.2.1">DNS SRV does not provide all the necessary configuration parameters. For example, we need all of:<a href="#section-8.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<ul class="normal">
<li class="normal" id="section-8.2-3.1">
            <p id="section-8.2-3.1.1">the username form ("fred@example.com", or "fred", or "fred\EXAMPLE", or even a username with no relation to the email address)<a href="#section-8.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-3.2">
            <p id="section-8.2-3.2.1">authentication method (password, CRAM-MD5, OAuth2, SSL client certificate)<a href="#section-8.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.2-3.3">
            <p id="section-8.2-3.3.1">authentication method parameters (e.g. OAuth parameters)<a href="#section-8.2-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.2-4">and other parameters. If any of these parameters are not configured right, the configuration won't work. While these parameters could theoretically be added to DNS SRV, that would mean a new specification and render the idea void that this is a protocol that already exists, is standardized and deployed. It is unlikely that all DNS SRV records would be updated with the new values. Therefore, it does not solve the problem.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<p id="section-8.2-5">This specification was created as an answer to these deficiencies and provides an alternative to DNS SRV.<a href="#section-8.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="capabilities">
<section id="section-8.3">
        <h3 id="name-capabilities">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-capabilities" class="section-name selfRef">CAPABILITIES</a>
        </h3>
<p id="section-8.3-1">In the wild deployments from actual ISPs show that protocol-specific commands to find available authentication methods, e.g. IMAP <code>CAPABILITIES</code> or POP3 <code>CAPA</code>, are not reliable. Many email servers advertize authentication methods that do not work.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Some IMAP servers are default configured to list all SASL authentication methods that have corresponding libraries installed on the system, independent on whether they are actually configured to work. The client receives a long list of authentication methods, and many of them do not work. Additionally, the server response may be only "authentication failed" and may not indicate whether the method failed due to lack of configuration, or because the password was wrong. Because some authentication servers lock the account after 3 failed login attempts, and it may also fail due to unrelated reasons (e.g. username form, wrong password, etc.), the client cannot blindly issue countless login attempts. Locking the account must be avoided. So, simply attempting all methods and seeing which one works is not an option for the email client.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">Additionally, some email servers advertize Kerberos / GSSAPI, but when trying to use it, the method fails, and also runs into a long 2 minute timeout in some cases. End users consider that to be a broken app.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">Additionally, such commands are protocol specific and have to be implemented in multiple different ways.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<p id="section-8.3-5">Finally, some non-mail protocols may not support capabilties commands that include authentication methods.<a href="#section-8.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="risk">
<section id="section-9.1">
        <h3 id="name-risk">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-risk" class="section-name selfRef">Risk</a>
        </h3>
<p id="section-9.1-1">If an attacker can provide a forged configuration, the provided mail hostname and authentication server can be controlled by the attacker, and the attacker can get access to the plain text password of the user. The attack can be implemented as man-in-the-middle, so the end user might receive mail as expected and never notice the attack.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">An attacker gaining the plain text password of a real user is a very significant threat for the organization, not only because mail itself can contain sensitive information and can be used to issue orders within the organization that have wide-ranging impact, but given single-sign-on solutions, the same username and password may give access to other resources at the organization, including other computers or, in the case of admin users, even adminstrative access to the core of the entire organization.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">Multi-factor authentication might not defend against such attacks, because the user may believe to be logging into his email and therefore comply with any multi-factor authentication steps required.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dns">
<section id="section-9.2">
        <h3 id="name-dns">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-dns" class="section-name selfRef">DNS</a>
        </h3>
<p id="section-9.2-1">Any protocol that relies on DNS without further validation, e.g. http, should be considered insecure. Even if an http URL redirects to a https URL, and the domain of the https URL cannot be validated against the email domain, that is still insecure. This also applies to the DNS MX lookup and the https calls that base on its results, as described in section "MX".<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">One possible mitigation is to use multiple different DNS servers
and verify that the results match, e.g. to use the native DNS
resolver of the operating system, and additionally also query
a hardcoded DoH (DNS over HTTPS) server. Nonetheless,
the result should be used with care.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">Such insecure configs may only be used, if the end user confirms the config, particularly the resulting second-level domains. See section "User approval".<a href="#section-9.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="config-updates">
<section id="section-9.3">
        <h3 id="name-config-updates">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-config-updates" class="section-name selfRef">Config updates</a>
        </h3>
<p id="section-9.3-1">Part of the security properties of this protocol assume that the timeframe of possible attack is limited to the moment when the user manually sets up a new mail client. This moment is triggered by the end user, and a rare action - e.g. maybe once per year or even less, for typical setups -, so an attacker has limited chances to run an attack. While not a complete protection on its own, this reduces the risk significantly.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">However, if the mail client does regular configuration updates using this protocol, this security property is no longer given. For regular configuration updates, the mail client <span class="bcp14">MUST</span> use only mechanisms that are secure and cannot be tampered with by an active attacker. Furthermore, the user <span class="bcp14">SHOULD</span> still approve config changes.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<p id="section-9.3-3">But even with all these protections implemented, the mail client vendor should make a security assessment for the risks of making such regular updates. The mail client vendor should consider that servers can be hacked, and most users simply approve changes proposed by the app, so these give only a limited protection.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-security">
<section id="section-9.4">
        <h3 id="name-server-security">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-server-security" class="section-name selfRef">Server security</a>
        </h3>
<p id="section-9.4-1">Given that mail clients will trust the configuration, the server delivering it needs to be secure. Even though we call it "database", static configuration files that are generated before deployment in combination with a static web server offer better security and significantly better performance than dynamic queries from a database and responses generated on-the-fly on request. If a custom server is used, it <span class="bcp14">SHOULD</span> be updated regularly and hosted on a dedicated secure server with all unnecessary services and server features turned off.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">Additions and modifications to the configurations are applicable to all respective users and must be made with care. The authenticity of the configuration <span class="bcp14">MUST</span> be verified from authorative sources. Server hostnames <span class="bcp14">MUST</span> be compared with the email domain names they are serving, and if they differ, the ownership of the server hostnames <span class="bcp14">MUST</span> be validated.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4-3">For these reasons, mail clients may use the public mail config database mentioned above.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
<p id="section-9.4-4">The risk is mitigated to some degree by section "User approval".<a href="#section-9.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document has no IANA actions.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-normative-references">
<section id="section-11">
      <h2 id="name-normative-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
    <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ben Bucksch</span></div>
<div dir="auto" class="left"><span class="org">Beonex</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ben.bucksch@beonex.com" class="email">ben.bucksch@beonex.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
